<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webspark Macro Recorder</title>
    <!-- Link all your CSS files -->
    <link rel="stylesheet" href="/static/base.css">
    <link rel="stylesheet" href="/static/header.css">
    <link rel="stylesheet" href="/static/analyzer-form.css">
    <link rel="stylesheet" href="/static/stream.css">
    <link rel="stylesheet" href="/static/results.css">
    <link rel="stylesheet" href="/static/footer.css">
    <link rel="stylesheet" href="/static/macros.css">
    <link rel="stylesheet" href="/static/viewport.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Fixed background -->
    <div class="background-wrapper">
        <img src="/static/images/space-background.webp" alt="" class="background-image">
    </div>

    <!-- Main content -->
    <div class="main-content">
        {% include 'partials/header.html' %}

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content-left">
                <h1 class="hero-title">Macro<br>Recorder</h1>
                <p class="hero-subtitle">Record user interactions on any website and replay them as macros. Perfect for automated testing, user journey analysis, and workflow automation.</p>

                <form id="record-form" class="url-form">
                    <input
                        id="record-url" 
                        type="text"
                        placeholder="Enter URL to record interactions"
                        value="{{ default_url }}"
                        class="url-input">
                    <button type="button" id="start-recording" class="analyze-button">
                        <i class="fas fa-play"></i> Start Recording
                    </button>
                </form>
            </div>
        </section>

        <!-- Hidden fields for recording state -->
        <input type="hidden" id="macro-name" value="">
        <div id="action-count" style="display: none;">0</div>
        <div id="recording-time" style="display: none;">00:00</div>
        <div id="recording-status" style="display: none;">Ready to record</div>

        <!-- Browser Preview Section -->
        <section class="browser-section" id="browser-section" style="display: none;">
            <div class="browser-card">
                <div class="browser-header">
                    <div class="browser-controls">
                        <div class="browser-dots">
                            <span class="dot red"></span>
                            <span class="dot yellow"></span>
                            <span class="dot green"></span>
                        </div>
                        <div class="browser-url-bar" id="browser-url-display"></div>
                        <div class="browser-status" id="browser-status">Loading...</div>
                    </div>
                </div>
                <div class="browser-viewport" id="browser-viewport">
                    <!-- Interactive viewport for live browser -->
                    <div class="viewport-container">
                        <img id="browser-frame" src="" alt="Live browser view" style="display: none;" />
                        <div class="viewport-overlay" id="viewport-overlay"></div>
                        <div class="viewport-loading" id="viewport-loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Starting browser session...</p>
                        </div>
                    </div>
                    
                    <!-- Tealium events and Actions panel -->
                    <div class="tealium-panel">
                        <div class="panel-section">
                            <h4><i class="fas fa-chart-line"></i> Tealium Events</h4>
                            <div id="tealium-events-display" class="events-container">
                                <div class="no-events">No events captured yet</div>
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <h4><i class="fas fa-network-wired"></i> Network Beacons</h4>
                            <div id="network-beacons-display" class="beacons-container">
                                <div class="no-beacons">No beacons detected yet</div>
                            </div>
                        </div>
                        
                        <div class="panel-section actions-panel">
                            <h4><i class="fas fa-mouse-pointer"></i> Recorded Actions</h4>
                            <div id="action-list" class="actions-container">
                                <div class="no-actions">Start recording to see captured interactions</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Saved Macros Section -->
		<section class="results-section">
			<div class="results-card" id="macros-card">
				<div class="card-header">
					<h2><i class="fas fa-list"></i> Saved Macros</h2>
				</div>
                <div class="card-body">
                    <div id="macros-container" class="macros-container">
						<div class="macros-list" id="macros-list">
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <h3>No Macros Saved Yet</h3>
                                <p>Record your first macro to see it here. Saved macros can be replayed, edited, and exported.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

		<!-- Macro Analysis Engine (same UI as homepage) -->
		<section class="analysis-section" id="macro-analysis-engine">
			<div class="analysis-card">
				<div class="card-header">
					<h2><i class="fas fa-terminal"></i> Analysis Engine</h2>
					<div class="status-badge" id="analysis-status">Waiting to start</div>
				</div>
				<div class="card-body">
					<div class="analysis-layout">
						<!-- Analysis Element -->
						<div class="ai-agent-element">
							<div class="ai-agent-circle"></div>
						</div>

						<!-- Analyzing Label -->
						<div class="analyzing-label">ANALYZING TAG PERFORMANCE</div>

						<!-- Container for Stages and Log (side-by-side) -->
						<div class="stages-and-log-container">
							<div class="analysis-left"> <!-- Stages -->
								<div class="stages-container">
									<!-- Stage: Initialization -->
									<div class="stage pending" id="stage-setup">
										<div class="stage-icon"><i class="fas fa-rocket"></i></div>
										<div class="stage-label">INITIALIZATION</div>
									</div>
									<!-- Stage: Page Load -->
									<div class="stage pending" id="stage-loading">
										<div class="stage-icon"><i class="fas fa-globe"></i></div>
										<div class="stage-label">PAGE LOAD</div>
									</div>
									<!-- Stage: Data Collection -->
									<div class="stage pending" id="stage-data">
										<div class="stage-icon"><i class="fas fa-database"></i></div>
										<div class="stage-label">DATA COLLECTION</div>
									</div>
									<!-- Stage: Completion -->
									<div class="stage pending" id="stage-complete">
										<div class="stage-icon"><i class="fas fa-check"></i></div>
										<div class="stage-label">COMPLETION</div>
									</div>
								</div>
							</div>

							<div class="analysis-right"> <!-- Log -->
								<div class="live-log-panel" id="live-log-panel">
									<div class="live-log-content-wrapper">
										<div class="live-log-header">LIVE LOG</div>
										<ul id="live-log-list" class="live-log-messages"></ul>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Loading Animation -->
					<div id="loading" class="loading-container" style="display: none;">
						<div class="loading-animation">
							<div class="loading-circle"></div>
							<div class="loading-circle"></div>
							<div class="loading-circle"></div>
							<div class="loading-pulse"></div>
						</div>
						<div class="loading-text">Processing</div>
					</div>

					<!-- Error Message Container -->
					<div id="error-message" class="error-message"></div>
				</div>
			</div>
		</section>

		<!-- Macro Analysis Results Section -->
		<section class="results-section">
			<div class="results-card expandable" id="results-card">
				<div class="card-header toggle-expand">
					<h2><i class="fas fa-chart-pie"></i> Analysis Results</h2>
					<div class="card-controls">
						<button id="copy-results" class="btn-icon" title="Copy results">
							<i class="fas fa-copy"></i>
						</button>
						<button id="toggle-expand-btn" class="btn-icon" title="Expand/Collapse">
							<i class="fas fa-expand-alt"></i>
						</button>
					</div>
				</div>
				<div class="card-body">
					<div id="results-container" class="results-container">
						<div class="results-tabs">
							<button class="tab-button active" data-tab="summary-tab">Summary</button>
							<button class="tab-button" data-tab="pageview-tab">Page View</button>
							<button class="tab-button" data-tab="click-events-tab">Click Events</button>
							<button class="tab-button" data-tab="visual-tab">Visualization</button>
						</div>

						<div class="tab-content">
							<div id="summary-tab" class="tab-pane active">
								<div class="section-header">
									<i class="fas fa-chart-bar"></i> Analysis Summary
								</div>
								<pre id="results-pre"></pre>
							</div>
							<div id="pageview-tab" class="tab-pane">
								<div class="section-header">
									<i class="fas fa-eye"></i> Page View Data
								</div>
								<div id="pageview-data-content">
									<table class="event-table" id="utag-data-table">
										<thead>
											<tr>
												<th>Data Key</th>
												<th>Value</th>
											</tr>
										</thead>
										<tbody></tbody>
									</table>
								</div>
							</div>
							<div id="click-events-tab" class="tab-pane">
								<div class="section-header">
									<i class="fas fa-mouse-pointer"></i> Click Events
								</div>
								<div id="event-type-tabs" class="event-type-tabs"></div>
								<div id="event-type-content" class="event-type-content"></div>
							</div>
							<div id="visual-tab" class="tab-pane">
								<div id="visualization-area"></div>
							</div>
						</div>

						<div class="download-container">
							<a id="download-json" href="#" download="analysis_results.json" class="btn-secondary">
								<i class="fas fa-download"></i> Download Results
							</a>
						</div>
					</div>

					<!-- Empty state (shown before first analysis) -->
					<div class="results-empty-state">
						<div class="empty-state-icon">
							<i class="fas fa-search"></i>
						</div>
						<h3 class="empty-state-title">No Analysis Results Yet</h3>
						<p class="empty-state-message">Use the Analyze button on a saved macro to run analysis and see results here.</p>
					</div>
				</div>
			</div>
		</section>

        <!-- Notification for actions -->
        <div id="notification" class="notification">
            <div class="notification-icon"><i class="fas fa-check-circle"></i></div>
            <div class="notification-content">Action recorded!</div>
        </div>

        <!-- Enhanced Footer Section -->
        <footer class="app-footer">
            <!-- Social Links -->
            <div class="footer-social">
                <a href="#" class="social-link" title="GitHub"><i class="fab fa-github"></i></a>
                <a href="#" class="social-link" title="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-link" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
            </div>

            <!-- Footer Navigation -->
            <nav class="footer-nav">
                <a href="#" class="footer-nav-link">Home</a>
                <a href="#" class="footer-nav-link">Documentation</a>
                <a href="#" class="footer-nav-link">About</a>
                <a href="#" class="footer-nav-link">Privacy Policy</a>
                <a href="#" class="footer-nav-link">Terms of Service</a>
            </nav>

            <!-- Copyright -->
            <p> 2025 Webspark Macro Recorder | All rights reserved</p>

            <!-- Attribution -->
            <div class="attribution">
                Made with <i class="fas fa-heart" style="color: #ef4444;"></i> for automation enthusiasts
            </div>

            <!-- Visual Effects -->
            <div class="footer-wave"></div>
            <div class="star-field">
                <!-- Stars generated via JavaScript -->
            </div>
        </footer>

        <!-- Additional styles for recording controls -->
        <style>
            .control-button-danger {
                background: #dc3545 !important;
                border-color: #dc3545 !important;
                color: white !important;
            }
            
            .control-button-danger:hover:not(:disabled) {
                background: #c82333 !important;
                border-color: #bd2130 !important;
            }
            
            .control-button-danger:disabled {
                background: #6c757d !important;
                border-color: #6c757d !important;
                opacity: 0.5;
            }
            
            /* Action list improvements */
            .action-meta {
                display: flex;
                gap: 0.5rem;
                flex-wrap: wrap;
                margin-top: 0.5rem;
                align-items: flex-start;
            }
            
            .action-selector {
                background: #f1f3f4;
                color: #5f6368;
                padding: 4px 8px;
                border-radius: 3px;
                font-family: 'JetBrains Mono', monospace;
                font-size: 0.75rem;
                word-break: break-all;
                white-space: normal;
                cursor: help;
                line-height: 1.3;
                border: 1px solid #e1e5e9;
            }
            
            .action-description {
                background: #e8f4f8;
                color: #2c5282;
                padding: 4px 8px;
                border-radius: 3px;
                font-size: 0.8rem;
                word-break: break-all;
                white-space: normal;
                cursor: help;
                line-height: 1.3;
                border: 1px solid #bee3f8;
                flex: 1;
            }
            
            .action-type {
                background: #4f79ff;
                color: white;
                padding: 2px 6px;
                border-radius: 3px;
                font-size: 0.75rem;
                text-transform: uppercase;
                font-weight: 500;
                flex-shrink: 0;
            }
            
            .action-time {
                color: #666;
                font-size: 0.75rem;
                font-weight: 500;
                flex-shrink: 0;
            }
            
            /* Enhanced analyze button styling */
            .btn-analyze-primary {
                background: #28a745 !important;
                color: white !important;
                border: 2px solid #28a745 !important;
                padding: 0.5rem 1rem !important;
                font-weight: 600 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .btn-analyze-primary:hover {
                background: #218838 !important;
                border-color: #1e7e34 !important;
                transform: translateY(-1px) !important;
                box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3) !important;
            }
            
            /* Recording button states */
            .analyze-button.recording {
                background: linear-gradient(135deg, #dc3545, #e74c3c) !important;
                border-color: #dc3545 !important;
                animation: pulse-recording 2s infinite;
            }
            
            .analyze-button.recording:hover {
                background: linear-gradient(135deg, #c82333, #dc3545) !important;
                border-color: #bd2130 !important;
            }
            
            @keyframes pulse-recording {
                0%, 100% { box-shadow: 0 0 5px rgba(220, 53, 69, 0.3); }
                50% { box-shadow: 0 0 20px rgba(220, 53, 69, 0.7); }
            }
        </style>

        <!-- Star Generation Script -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const starField = document.querySelector('.star-field');
            if (starField) {
                for (let i = 0; i < 50; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.animationDelay = `${Math.random() * 4}s`;
                    starField.appendChild(star);
                }
            }
        });
        </script>

    </div>

    <!-- Import the main recorder script -->
    <script src="/static/recorder.js"></script>
</body>
</html>